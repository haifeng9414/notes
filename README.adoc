= 学习笔记
 
== 消息队列
[qanda]
消息队列能解决什么问题::
+
[%collapsible]
====
. 异步处理
  
  不用等待所有动作都执行完成，只需要完成必要的动作，如风险控制和锁定库存操作是必须的，但是生成订单和短信通知等动作可
  以异步操作，这样能够更快的返回请求结果
  
  异步请求使得非必要的动作可以并发执行，如上面说的生成订单和发送短信通知，提高了系统性能

. 流量控制

  请求到达网关后先保存到消息队列，后台服务再从消息队列获取请求，使得消息队列隔离了网关和后台服务，达到了”削峰“的目的

  在网关添加流量控制逻辑，如使用令牌桶算法，令牌生成器按照固定速率向消息队列生成令牌，网关处理请求时消费令牌，流量控
  制实现在网关，对后台服务无侵入，降低了系统复杂度

. 服务解耦
. 实现服务之间的观察者模式
. 消息广播
====

+
消息队列带来什么问题::
+
[%collapsible]
====
. 可用性降低，消息队列挂掉后可能会影响多个其他服务
. 增加了系统的复杂度，需要考虑消息丢失、重复消费、消息顺序等问题
. 数据不一致问题，如何保证发送消息和消费消息的原子性
====
+